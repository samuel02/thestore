<div class="page-header">
  <h1>
    <%= link_to "The Store", root_path %> -
    <%= @product.name %>
  </h1>
</div>

<div class="row">
  <div class="span8 product-display">
    <div class="row">
      <div class="span4">
        <h3 style="margin-top:0px">Description</h3>
        <p><%= @product.description %></p>
        <table class="table table-condensed">
          <tr>
            <td><strong>Price</strong></td>
            <td><%= number_to_currency @product.price %></td>
          </tr>
          <tr>
            <td><strong>In stock</strong></td>
            <td><%= @product.quantity %> piece(s)</td>
          </tr>
          <tr>
            <td><strong>Customer rating</strong></td>
            <td><%= rating_stars @product.average_rating %></td>
          </tr>
        </table>
      </div>
      <div class="span4">
        <img src="<%= @product.image_url %>">
      </div>
    </div>
    <div class="row">
      <div class="span8">
        <div class="form-actions">
          <%= link_to "Back",
                      root_path,
                      :class => "btn" %>
          <%= link_to "Add to cart",
                      line_items_path(:product_id => @product),
                      :method => 'post',
                      :class => "btn btn-primary" %>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="span8">
        <div class="page-header">
          <h3><i class="icon-comment"></i> Comments</h3>
        </div>
        <div class="comments">
          <% if @product.comments.any? %>
            <% @product.comments.each do |comment| %>
              <% if comment.level == 0 %>
                <%= render :partial => "pages/comment", :locals => { :comment => comment, :span => 8, :offset => 0, :level => 1 } %>
              <% end %>
            <% end %>
          <% else %>
            <p>No comments yet, add the first one!</p>
          <% end %>
        </div>
        <hr>
        <a href="#new-comment-modal" data-toggle="modal" class="btn btn-info pull-right">
          <i class="icon-comment"></i> Add comment
        </a>
      </div>
    </div>
  </div>
  <div class="span4 sidebar">
    <div class="well">
      <h3 style="margin-top:0px">Cart</h3>
      <% if @cart.line_items.size > 0 %>
        <table class="table table-striped table-condensed">
          <tr>
            <th>Product</th>
            <th>Amount</th>
            <th>Price</th>
            <th></th>
          </tr>
          <% @cart.line_items.each do |line_item| %>
            <tr>
              <td><%= line_item.product.name %></td>
              <td><%= line_item.amount %></td>
              <td><%= number_to_currency(line_item.price) %></td>
              <td>
                <%= link_to raw("<i class=\"icon-remove\"></i>"),
                            line_item_path(line_item),
                            :method => 'delete',
                            :class => "" %>
              </td>
            </tr>
          <% end %>
          <tr>
            <td></td>
            <td><strong>Total</strong></td>
            <td><%= number_to_currency(@cart.total_price) %></td>
            <td></td>
          </tr>
        </table>
        <hr>
        <div style="padding-bottom:15px">
          <%= link_to raw("<i class=\"icon-remove\"></i> Empty cart"),
                      '/empty_cart',
                      class: "btn btn-danger" %>
          <%= link_to raw("<i class=\"icon-shopping-cart\"></i> Checkout"),
                      new_order_path,
                      class: "btn btn-success" %>
        </div>
      <% else %>
        <p>No products in cart, add a product!</p>
      <% end %>
    </div>
  </div>
</div>

<div class="modal hide" id="new-comment-modal">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3>New comment</h3>
  </div>
  <%= form_for @comment do |f| %>
    <div class="modal-body">
      <fieldset>
        <%= f.hidden_field :product_id, :value => @product.id %>
        <div class="control-group">
          <h5>What would you like to tell the world?</h5>
          <div class="controls">
            <%= f.text_area :content, :rows => 4, :placeholder => "Your comment here..." %>
          </div>
        </div>
        <div class="control-group">
            <h5>Rate the product!</h5>
            <%= f.radio_button :rating, 1, :checked => "checked", :class => "star {half:true}" %>
            <%= f.radio_button :rating, 2, :class => "star {half:true}" %>
            <%= f.radio_button :rating, 3, :class => "star {half:true}" %>
            <%= f.radio_button :rating, 4, :class => "star {half:true}" %>
            <%= f.radio_button :rating, 5, :class => "star {half:true}" %>
        </div>
      </fieldset>
    </div>
    <div class="modal-footer">
      <a href="#" data-dismiss="modal" class="btn">Close</a>
      <%= f.submit "Add comment", :class => "btn btn-primary" %>
    </div>
  <% end %>
</div>